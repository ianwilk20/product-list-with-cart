<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <!-- displays site properly based on user's device -->
        <link rel="stylesheet" href="../output.css" />
        <link
            rel="icon"
            type="image/png"
            sizes="32x32"
            href="./assets/images/favicon-32x32.png"
        />
        <!-- <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Red+Hat+Text:ital,wght@0,300..700;1,300..700&display=swap"
            rel="stylesheet"
        /> -->
        <!-- <script src="https://cdn.tailwindcss.com"></script> -->

        <title>Frontend Mentor | Product list with cart</title>

        <!-- Feel free to remove these styles or customise in your own stylesheet 👍 -->
        <style>
            .attribution {
                font-size: 11px;
                text-align: center;
            }
            .attribution a {
                color: hsl(228, 45%, 44%);
            }
        </style>
    </head>
    <body class="p-6 font-redhat bg-zinc-50">
        <h1 class="text-4xl font-bold mb-6">Desserts</h1>

        <!-- Item container -->
        <div id="card-container" class="flex flex-col gap-6"></div>

        <!-- Your Cart -->
        <div
            id="cart-container"
            class="bg-white rounded-lg px-6 py-6 flex flex-col gap-8"
        >
            <h2 id="cart-your-cart" class="font-bold text-2xl text-rose-700">
                Your Cart (0)
            </h2>
            <div id="cart-prompt" class="flex flex-col items-center gap-2">
                <img src="./assets/images/illustration-empty-cart.svg" />
                <p class="text-yellow-900 text-sm font-medium">
                    Your added items will appear here
                </p>
            </div>
            <div id="cart-items"></div>
            <!-- <div id="cart-row" class="flex flex-col gap-4">
                <div
                    id="cart-item-container"
                    class="flex items-center justify-between"
                >
                    <div>
                        <p><b>Classic Tiramisu</b></p>
                        <div class="flex gap-2">
                            <p class="text-rose-700 mr-2 font-medium">1x</p>
                            <p class="text-slate-400">@ $5.50</p>
                            <p class="text-slate-500 font-medium">$5.50</p>
                        </div>
                    </div>
                    <button
                        class="rounded-xl border border-slate-500 flex justify-center items-center w-5 h-5 p-0"
                    >
                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            width="10"
                            height="10"
                            fill="none"
                            viewBox="0 0 10 10"
                        >
                            <path
                                fill="#64748b"
                                d="M8.375 9.375 5 6 1.625 9.375l-1-1L4 5 .625 1.625l1-1L5 4 8.375.625l1 1L6 5l3.375 3.375-1 1Z"
                            />
                        </svg>
                    </button>
                </div>
                <hr />
            </div> -->
            <div
                id="cart-order-total"
                class="hidden flex justify-between items-center"
            >
                <p>Order Total</p>
                <p
                    id="order-total-value"
                    class="text-2xl text-black font-bold"
                ></p>
            </div>
            <div
                id="cart-carbon-neutral"
                class="hidden flex gap-2 items-center align-middle rounded-md bg-rose-50 h-12 p-4"
            >
                <img src="./assets/images/icon-carbon-neutral.svg" />
                <p class="text-sm">
                    This is a
                    <span class="font-medium">carbon-neutral</span> delivery
                </p>
            </div>
            <button
                id="cart-confirm-order"
                class="hidden rounded-full bg-rose-700 text-white font-medium h-12"
            >
                Confirm Order
            </button>
        </div>

        <div class="attribution my-12">
            Challenge by
            <a href="https://www.frontendmentor.io?ref=challenge"
                >Frontend Mentor</a
            >. Coded by <a href="#">Your Name Here</a>.
        </div>

        <script>
            const yourCart = document.getElementById('cart-your-cart')
            const cartItems = document.getElementById('cart-items')
            const orderTotal = document.getElementById('order-total-value')
            const cartPrompt = document.getElementById('cart-prompt')
            const cartOrderTotalContainer =
                document.getElementById('cart-order-total')
            const carbonNeutralBanner = document.getElementById(
                'cart-carbon-neutral'
            )
            const confirmOrderButton =
                document.getElementById('cart-confirm-order')

            function addItemToCart(id) {
                console.log('In addItemToCart - id: ', id)
                currCart = localStorage.getItem('cart')

                // Class changes
                cartPrompt.classList.add('hidden')
                cartOrderTotalContainer.classList.remove('hidden')
                carbonNeutralBanner.classList.remove('hidden')
                confirmOrderButton.classList.remove('hidden')

                if (currCart) {
                    parsedCurrCart = JSON.parse(currCart)
                    foundItem = parsedCurrCart.find((item) => item.id === id)
                    if (foundItem) {
                        console.log('Add to cart: Found existing item in cart')
                        // Found existing item in card already so increment
                        incrementQuantity(id)
                    } else {
                        // Cart has items - this item is not already in cart
                        console.log(
                            'Add to cart: Did not find existing item in cart, adding now..'
                        )
                        newCartItem = { id: id, quantity: 1 }
                        newCart = [...parsedCurrCart, newCartItem]
                        localStorage.setItem('cart', JSON.stringify(newCart))
                    }
                } else {
                    console.log(
                        'Add to cart: No cart exists, creating cart and adding item'
                    )
                    localStorage.setItem(
                        'cart',
                        JSON.stringify([{ id: id, quantity: 1 }])
                    )
                }

                addToCartBtn = document.getElementById(
                    `init-cart-btn-item-${id}`
                )
                cartIncDecBtn = document.getElementById(
                    `cart-inc-dec-btn-item-${id}`
                )
                itemCount = document.getElementById(`item-${id}-cart-count`)
                itemImage = document.getElementById(`item-${id}-image`)
                addToCartBtn.classList.add('hidden')
                itemCount.innerText = 1
                cartIncDecBtn.classList.remove('hidden')
                itemImage.classList.add('border-2', 'border-rose-700')

                window.dispatchEvent(
                    new StorageEvent('storage', { key: 'cart' })
                )
            }

            function incrementQuantity(id) {
                console.log('In incrementQuantity - id: ', id)
                currCart = localStorage.getItem('cart')
                if (currCart) {
                    parsedCurrCart = JSON.parse(currCart)
                    foundItem = parsedCurrCart.find((item) => item.id === id)
                    if (foundItem) {
                        console.log(
                            'Increment Quantity: Found item in card, incrementing'
                        )
                        // Found existing item in card already so increment
                        newQuantity = ++foundItem.quantity
                        foundCartItem = {
                            id: foundItem.id,
                            quantity: newQuantity,
                        }
                        console.log('Found cart item: ', foundCartItem)
                        newCart = parsedCurrCart.map((item) =>
                            item.id === id ? foundCartItem : item
                        )
                        console.log('new cart: ', newCart)
                        localStorage.setItem('cart', JSON.stringify(newCart))
                        itemCount = document.getElementById(
                            `item-${id}-cart-count`
                        )
                        itemCount.innerText = newQuantity
                        window.dispatchEvent(
                            new StorageEvent('storage', { key: 'cart' })
                        )
                    }
                }
            }

            function decrementQuantity(id) {
                console.log('In decrementQuantity - id: ', id)
                currCart = localStorage.getItem('cart')
                if (currCart) {
                    parsedCurrCart = JSON.parse(currCart)
                    foundItem = parsedCurrCart.find((item) => item.id === id)
                    if (foundItem) {
                        // Found existing item in card already so decrement
                        if (foundItem.quantity === 1) {
                            removeFromCart(id)
                            // Item no longer in card - add back initial styling
                            addToCartBtn = document.getElementById(
                                `init-cart-btn-item-${id}`
                            )
                            cartIncDecBtn = document.getElementById(
                                `cart-inc-dec-btn-item-${id}`
                            )
                            addToCartBtn.classList.remove('hidden')
                            cartIncDecBtn.classList.add('hidden')
                            itemImage.classList.remove(
                                'border-2',
                                'border-rose-700'
                            )
                        } else {
                            newQuantity = --foundItem.quantity
                            foundCartItem = {
                                id: foundItem.id,
                                quantity: newQuantity,
                            }
                            newCart = parsedCurrCart.map((item) =>
                                item.id === id ? foundCartItem : item
                            )
                            localStorage.setItem(
                                'cart',
                                JSON.stringify(newCart)
                            )
                            itemCount = document.getElementById(
                                `item-${id}-cart-count`
                            )
                            itemCount.innerText = newQuantity
                        }
                        window.dispatchEvent(
                            new StorageEvent('storage', { key: 'cart' })
                        )
                    }
                }
            }

            function removeFromCart(id) {
                currCart = localStorage.getItem('cart')
                if (currCart) {
                    parsedCurrCart = JSON.parse(currCart)
                    foundItem = parsedCurrCart.find((item) => item.id === id)
                    cardWithoutItem = parsedCurrCart.filter(
                        (item) => item.id !== id
                    )
                    localStorage.setItem(
                        'cart',
                        JSON.stringify(cardWithoutItem)
                    )
                    addToCartBtn = document.getElementById(
                        `init-cart-btn-item-${id}`
                    )
                    cartIncDecBtn = document.getElementById(
                        `cart-inc-dec-btn-item-${id}`
                    )
                    addToCartBtn.classList.remove('hidden')
                    cartIncDecBtn.classList.add('hidden')
                    itemImage.classList.remove('border-2', 'border-rose-700')
                    window.dispatchEvent(
                        new StorageEvent('storage', { key: 'cart' })
                    )
                }
            }

            document.addEventListener('DOMContentLoaded', () => {
                const cardContainer = document.getElementById('card-container')

                jsonData.forEach((item) => {
                    const div0 = document.createElement('div')
                    div0.className = 'flex flex-col gap-8'

                    const div1 = document.createElement('div')
                    div1.className = 'flex justify-center relative'

                    const img = document.createElement('img')
                    img.id = `item-${item.id}-image`
                    img.src = item.image.mobile
                    img.className = 'rounded-lg'

                    const btnAddToCart = document.createElement('button')
                    btnAddToCart.id = `init-cart-btn-item-${item.id}`
                    btnAddToCart.className =
                        'absolute translate-y-1/2 bottom-0 border border-gray-500 rounded-full py-3 px-6 bg-white text-black text-sm font-medium inline-flex items-center gap-2'
                    btnAddToCart.onclick = function () {
                        addItemToCart(item.id)
                    }

                    const cartInnerHTML = `
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="21"
                        height="20"
                        fill="none"
                        viewBox="0 0 21 20"
                    >
                        <g fill="#C73B0F" clip-path="url(#a)">
                            <path
                                d="M6.583 18.75a1.25 1.25 0 1 0 0-2.5 1.25 1.25 0 0 0 0 2.5ZM15.334 18.75a1.25 1.25 0 1 0 0-2.5 1.25 1.25 0 0 0 0 2.5ZM3.446 1.752a.625.625 0 0 0-.613-.502h-2.5V2.5h1.988l2.4 11.998a.625.625 0 0 0 .612.502h11.25v-1.25H5.847l-.5-2.5h11.238a.625.625 0 0 0 .61-.49l1.417-6.385h-1.28L16.083 10H5.096l-1.65-8.248Z"
                            />
                            <path
                                d="M11.584 3.75v-2.5h-1.25v2.5h-2.5V5h2.5v2.5h1.25V5h2.5V3.75h-2.5Z"
                            />
                        </g>
                        <defs>
                            <clipPath id="a">
                                <path fill="#fff" d="M.333 0h20v20h-20z" />
                            </clipPath>
                        </defs>
                    </svg>
                    <span>Add to Cart</span>
                    `

                    btnAddToCart.innerHTML = cartInnerHTML

                    const div2 = document.createElement('div')
                    div2.id = `cart-inc-dec-btn-item-${item.id}`
                    div2.className =
                        'hidden absolute bottom-0 translate-y-1/2 flex items-center gap-12 rounded-full py-3 px-3 bg-rose-700 text-white text-sm font-medium'

                    const decQuantity = document.createElement('button')
                    decQuantity.class =
                        'flex items-center justify-center w-5 h-5 border-2 border-white rounded-xl'
                    decQuantity.onclick = function () {
                        decrementQuantity(item.id)
                    }

                    const decrementIcon = `
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="12"
                        height="4"
                        fill="none"
                        viewBox="0 0 10 2"
                    >
                        <path fill="#fff" d="M0 .375h10v1.25H0V.375Z" />
                    </svg>`
                    decQuantity.innerHTML = decrementIcon

                    const itemCount = document.createElement('p')
                    itemCount.id = `item-${item.id}-cart-count`
                    itemCount.className = 'text-white font-normal'

                    const incQuantity = document.createElement('button')
                    incQuantity.class =
                        'flex items-center justify-center w-5 h-5 border-2 border-white rounded-xl'
                    incQuantity.onclick = function () {
                        incrementQuantity(item.id)
                    }

                    const incrementIcon = `
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="12"
                        height="12"
                        fill="none"
                        viewBox="0 0 10 10"
                    >
                        <path
                            fill="#fff"
                            d="M10 4.375H5.625V0h-1.25v4.375H0v1.25h4.375V10h1.25V5.625H10v-1.25Z"
                        />
                    </svg>`
                    incQuantity.innerHTML = incrementIcon

                    div2.appendChild(decQuantity)
                    div2.appendChild(itemCount)
                    div2.appendChild(incQuantity)

                    div1.appendChild(img)
                    div1.appendChild(btnAddToCart)
                    div1.appendChild(div2)

                    const div3 = document.createElement('div')
                    const pCategory = document.createElement('p')
                    pCategory.className = 'text-sm text-gray-400'
                    pCategory.innerText = item.category
                    const pItemName = document.createElement('p')
                    pItemName.className = 'text-base font-medium text-black'
                    pItemName.innerText = item.name
                    const pItemCost = document.createElement('p')
                    pItemCost.className = 'text-rose-700 font-medium font-sans'
                    pItemCost.textContent = Intl.NumberFormat('en-US', {
                        style: 'currency',
                        currency: 'USD',
                    }).format(item.price)

                    div3.appendChild(pCategory)
                    div3.appendChild(pItemName)
                    div3.appendChild(pItemCost)

                    div0.appendChild(div1)
                    div0.appendChild(div3)

                    cardContainer.appendChild(div0)
                })
            })

            window.addEventListener('storage', (event) => {
                console.log('In storage event listener')
                console.log(event)
                if (event.key === 'cart') {
                    curCart = JSON.parse(localStorage.getItem('cart'))
                    console.log('Current cart: ', curCart)
                    if (curCart.length && curCart.length > 0) {
                        refreshCartContents(curCart)
                    } else {
                        // Reset cart area
                        cartPrompt.classList.remove('hidden')
                        cartOrderTotalContainer.classList.add('hidden')
                        carbonNeutralBanner.classList.add('hidden')
                        confirmOrderButton.classList.add('hidden')
                        while (cartItems.firstChild) {
                            cartItems.removeChild(cartItems.firstChild)
                        }
                    }
                }
                return
            })

            function refreshCartContents(items) {
                while (cartItems.firstChild) {
                    cartItems.removeChild(cartItems.firstChild)
                }

                totalItemQuantity = items.reduce(
                    (acc, curVal) => acc + curVal.quantity,
                    0
                )
                yourCart.textContent = `Your Cart (${totalItemQuantity})`

                let totalCost = 0
                // Build the cart display like you did for the items
                items.forEach((item, idx) => {
                    console.log(jsonData)
                    foundItem = jsonData.find(
                        (storedItem) => storedItem.id === item.id.toString()
                    )
                    console.log(foundItem)
                    const crowdiv = document.createElement('div')
                    crowdiv.classList =
                        'flex flex-col gap-4 [&:not(:first-child)]:mt-4'
                    crowdiv.id = `cart-row-${idx}`

                    const citemdiv = document.createElement('div')
                    citemdiv.classList = 'flex items-center justify-between'
                    citemdiv.id = `cart-item-container-${idx}`

                    const itemdiv = document.createElement('div')
                    itemdiv.classList = 'flex flex-col gap-1'

                    const itemname = document.createElement('p')
                    itemname.classList = 'font-bold text-sm'
                    itemname.textContent = foundItem.name

                    const itemdetailsdiv = document.createElement('div')
                    itemdetailsdiv.classList = 'flex gap-2'

                    const itemquantity = document.createElement('p')
                    itemquantity.classList =
                        'text-rose-700 mr-2 font-medium text-sm'
                    itemquantity.textContent = `${item.quantity}x`

                    const itemcost = document.createElement('p')
                    itemcost.classList = 'text-slate-400 text-sm'
                    itemcost.textContent =
                        '@ ' +
                        Intl.NumberFormat('en-US', {
                            style: 'currency',
                            currency: 'USD',
                        }).format(foundItem.price)

                    const itemtotalcost = document.createElement('p')
                    itemtotalcost.classList =
                        'text-slate-500 font-medium text-sm'
                    itemtotalcost.textContent = Intl.NumberFormat('en-US', {
                        style: 'currency',
                        currency: 'USD',
                    }).format(foundItem.price * item.quantity)
                    totalCost += foundItem.price * item.quantity

                    itemdetailsdiv.appendChild(itemquantity)
                    itemdetailsdiv.appendChild(itemcost)
                    itemdetailsdiv.appendChild(itemtotalcost)

                    itemdiv.appendChild(itemname)
                    itemdiv.appendChild(itemdetailsdiv)

                    const removeItemBtn = document.createElement('button')
                    removeItemBtn.onclick = function () {
                        removeFromCart(foundItem.id)
                    }
                    removeItemBtn.classList =
                        'rounded-xl border border-slate-500 flex justify-center items-center w-5 h-5 p-0'

                    const removeIcon = `
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="10"
                        height="10"
                        fill="none"
                        viewBox="0 0 10 10"
                    >
                        <path
                            fill="#64748b"
                            d="M8.375 9.375 5 6 1.625 9.375l-1-1L4 5 .625 1.625l1-1L5 4 8.375.625l1 1L6 5l3.375 3.375-1 1Z"
                        />
                    </svg>
                    `

                    removeItemBtn.innerHTML = removeIcon

                    citemdiv.appendChild(itemdiv)
                    citemdiv.appendChild(removeItemBtn)

                    const lineBreak = document.createElement('hr')

                    crowdiv.appendChild(citemdiv)
                    crowdiv.appendChild(lineBreak)

                    cartItems.appendChild(crowdiv)
                })

                orderTotal.textContent = Intl.NumberFormat('en-US', {
                    style: 'currency',
                    currency: 'USD',
                }).format(totalCost)
            }

            const jsonData = [
                {
                    image: {
                        thumbnail: './assets/images/image-waffle-thumbnail.jpg',
                        mobile: './assets/images/image-waffle-mobile.jpg',
                        tablet: './assets/images/image-waffle-tablet.jpg',
                        desktop: './assets/images/image-waffle-desktop.jpg',
                    },
                    name: 'Waffle with Berries',
                    category: 'Waffle',
                    price: 6.5,
                    id: '1',
                },
                {
                    image: {
                        thumbnail:
                            './assets/images/image-creme-brulee-thumbnail.jpg',
                        mobile: './assets/images/image-creme-brulee-mobile.jpg',
                        tablet: './assets/images/image-creme-brulee-tablet.jpg',
                        desktop:
                            './assets/images/image-creme-brulee-desktop.jpg',
                    },
                    name: 'Vanilla Bean Crème Brûlée',
                    category: 'Crème Brûlée',
                    price: 7.0,
                    id: '2',
                },
                {
                    image: {
                        thumbnail:
                            './assets/images/image-macaron-thumbnail.jpg',
                        mobile: './assets/images/image-macaron-mobile.jpg',
                        tablet: './assets/images/image-macaron-tablet.jpg',
                        desktop: './assets/images/image-macaron-desktop.jpg',
                    },
                    name: 'Macaron Mix of Five',
                    category: 'Macaron',
                    price: 8.0,
                    id: '3',
                },
                {
                    image: {
                        thumbnail:
                            './assets/images/image-tiramisu-thumbnail.jpg',
                        mobile: './assets/images/image-tiramisu-mobile.jpg',
                        tablet: './assets/images/image-tiramisu-tablet.jpg',
                        desktop: './assets/images/image-tiramisu-desktop.jpg',
                    },
                    name: 'Classic Tiramisu',
                    category: 'Tiramisu',
                    price: 5.5,
                    id: '4',
                },
                {
                    image: {
                        thumbnail:
                            './assets/images/image-baklava-thumbnail.jpg',
                        mobile: './assets/images/image-baklava-mobile.jpg',
                        tablet: './assets/images/image-baklava-tablet.jpg',
                        desktop: './assets/images/image-baklava-desktop.jpg',
                    },
                    name: 'Pistachio Baklava',
                    category: 'Baklava',
                    price: 4.0,
                    id: '5',
                },
                {
                    image: {
                        thumbnail:
                            './assets/images/image-meringue-thumbnail.jpg',
                        mobile: './assets/images/image-meringue-mobile.jpg',
                        tablet: './assets/images/image-meringue-tablet.jpg',
                        desktop: './assets/images/image-meringue-desktop.jpg',
                    },
                    name: 'Lemon Meringue Pie',
                    category: 'Pie',
                    price: 5.0,
                    id: '6',
                },
                {
                    image: {
                        thumbnail: './assets/images/image-cake-thumbnail.jpg',
                        mobile: './assets/images/image-cake-mobile.jpg',
                        tablet: './assets/images/image-cake-tablet.jpg',
                        desktop: './assets/images/image-cake-desktop.jpg',
                    },
                    name: 'Red Velvet Cake',
                    category: 'Cake',
                    price: 4.5,
                    id: '7',
                },
                {
                    image: {
                        thumbnail:
                            './assets/images/image-brownie-thumbnail.jpg',
                        mobile: './assets/images/image-brownie-mobile.jpg',
                        tablet: './assets/images/image-brownie-tablet.jpg',
                        desktop: './assets/images/image-brownie-desktop.jpg',
                    },
                    name: 'Salted Caramel Brownie',
                    category: 'Brownie',
                    price: 4.5,
                    id: '8',
                },
                {
                    image: {
                        thumbnail:
                            './assets/images/image-panna-cotta-thumbnail.jpg',
                        mobile: './assets/images/image-panna-cotta-mobile.jpg',
                        tablet: './assets/images/image-panna-cotta-tablet.jpg',
                        desktop:
                            './assets/images/image-panna-cotta-desktop.jpg',
                    },
                    name: 'Vanilla Panna Cotta',
                    category: 'Panna Cotta',
                    price: 6.5,
                    id: '9',
                },
            ]
        </script>
    </body>
</html>
